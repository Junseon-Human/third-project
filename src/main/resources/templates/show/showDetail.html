<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">
</head>
<body>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=35267baa78fc79afc7626fc0349548fe"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

<div class="container">

    <input type="hidden" id="showDetail" th:value="${show.mt20id}">
    <h1 th:text="${show.prfnm}"></h1>

    <p th:text="${show.prfstate}"></p>
    <div class="d-flex">
        <div class="poster">
            <img th:src="${show.poster}" class="img-fluid rounded-start" th:alt="${show.prfnm}">
            <p th:text="${show.likeCount}"></p>
        </div>

        <div class="table">
            <table class="table">
                <tbody>
                <tr>
                    <th scope="row">공연장소</th>
                    <td th:text="${show.fcltynm}"></td>
                </tr>
                <tr>
                    <th scope="row">공연기간</th>
                    <td th:text="${show.prfpdfrom} + '~' + ${show.prfpdto}"></td>
                </tr>
                <tr>
                    <th scope="row">관람시간</th>
                    <td th:text="${show.prfruntime}"></td>
                </tr>
                <tr>
                    <th scope="row">관람연령</th>
                    <td th:text="${show.prfage}"></td>
                </tr>
                <tr>
                    <th scope="row">가격</th>
                    <td th:text="|${show.pcseguidance}원|"></td>
                </tr>
                <tr>
                    <th scope="row">출연진</th>
                    <td th:text="${show.prfcast}"></td>
                </tr>
                <tr>
                    <th scope="row">제작진</th>
                    <td th:text="${show.prfcrew}"></td>
                </tr>
                <tr>
                    <th scope="row">기획사</th>
                    <td th:text="${show.entrpsnm}"></td>
                </tr>
                <tr>
                    <th scope="row">주최</th>
                    <td th:text="${show.entrpsnmH}"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <img th:src="${show.styurl}" class="img-fluid rounded-start" th:alt="${show.prfnm}">
    </div>

<!--장소 지도 띄우기-->
    <input type="hidden" name="la" th:value="${showFacility.la}">
    <input type="hidden" name="lo" th:value="${showFacility.lo}">
    <input type="hidden" name="fcltynm" th:value="${show.fcltynm}">
    <input type="hidden" name="adres" th:value="${showFacility.adres}">
    <h3 th:text="${showFacility.adres}"></h3>
    <div id="map" style="width: 500px; height: 400px;"></div>
</div>

<script>
    let container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
    let la = $('input[name=la]').val();
    let lo = $('input[name=lo]').val();
    let options = { //지도를 생성할 때 필요한 기본 옵션
        center: new kakao.maps.LatLng(la, lo), //지도의 중심좌표.
        level: 3 //지도의 레벨(확대, 축소 정도)
    };
    let map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

    var markerPosition  = new kakao.maps.LatLng(la, lo);  // 마커가 표시될 위치
    var marker = new kakao.maps.Marker({  // 마커 생성
        position: markerPosition
    });
    marker.setMap(map);

    // 마커를 클릭했을 때 마커 위에 표시할 인포윈도우를 생성
    //위치정보 길찾기로 넘기기
    var iwContent = '<div style="padding:5px;">' + $('input[name=fcltynm]').val() +
        '<br> <a href="https://map.kakao.com/link/to/' + $('input[name=adres]').val() +
        ',' + la + ',' + lo + '" style="color:blue" target="_blank">길찾기</a></div>',
        iwPosition = new kakao.maps.LatLng(la, lo),
        iwRemoveable = true; // removeable 속성을 ture 로 설정하면 인포윈도우를 닫을 수 있는 x버튼이 표시됩니다

    var infowindow = new kakao.maps.InfoWindow({
        content : iwContent,
        position : iwPosition,
        removable : iwRemoveable
    });

    kakao.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map, marker);
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
</body>
</html>