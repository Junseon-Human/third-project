<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>

<!-- 사용자 CSS 추가 -->
<th:block layout:fragment="css">
    <style>
        .review-rating {
            display: inline-block;
            direction: rtl;
            border: 0;
        }

        .review-rating legend {
            text-align: right;
        }

        .update-rating {
            display: inline-block;
            direction: rtl;
            border: 0;
        }

        .update-rating legend {
            text-align: right;
        }

        #review-form input[type=radio] {
            display: none;
        }

        #review-form label {
            font-size: 3em;
            color: transparent;
            text-shadow: 0 0 0 #f0f0f0;
        }

        #review-form label:hover {
            text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
        }

        #review-form label:hover ~ label {
            text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
        }

        #review-form input[type=radio]:checked ~ label {
            text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
        }

        #review-content {
            width: 100%;
            height: 150px;
            padding: 10px;
            box-sizing: border-box;
            border: solid 1.5px #D3D3D3;
            border-radius: 5px;
            font-size: 16px;
            resize: none;
        }

        .update-rating input[type=radio] {
            display: none;
        }

        .update-rating label {
            font-size: 1em;
            color: transparent;
            text-shadow: 0 0 0 #f0f0f0;
        }

        .update-rating label:hover {
            text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
        }

        .update-rating label:hover ~ label {
            text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
        }

        .update-rating input[type=radio]:checked ~ label {
            text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
        }

        .updateContent {
            width: 100%;
            height: 150px;
            padding: 10px;
            box-sizing: border-box;
            border: solid 1.5px #D3D3D3;
            border-radius: 5px;
            font-size: 10px;
            resize: none;
        }
    </style>
</th:block>

<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function () {

            $(document).on('click', '.modifyReview', function (e) {
                e.preventDefault();
                const target = $(this).data('bs-target'); // Collapse 대상 요소를 가져옴
                $(target).collapse('toggle'); // Collapse 기능 동작
            });

            //리뷰 생성 메서드
            $('#review-form').on('submit', function (event) {
                event.preventDefault();
                createReview(); //리뷰 생성 함수
            });

            //즐겨찾기 로그인체크
            window.checkLogin = function () {
                const isLogin = $('input[name=isLogin]').val() === 'true'; // boolean으로 변환
                console.log('로그인 상태 : ' + isLogin);
                if (!isLogin) {
                    alert("로그인 후 이용해주세요");
                    location.href = "/members/login";
                    return false; // 폼 제출 중단
                }
                return true; // 로그인 상태일 경우 폼 제출 계속
            };

            //카카오 지도 api
            let container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
            let la = $('input[name=la]').val();
            let lo = $('input[name=lo]').val();
            let options = { //지도를 생성할 때 필요한 기본 옵션
                center: new kakao.maps.LatLng(la, lo), //지도의 중심좌표.
                level: 3 //지도의 레벨(확대, 축소 정도)
            };
            let map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

            var markerPosition = new kakao.maps.LatLng(la, lo);  // 마커가 표시될 위치
            var marker = new kakao.maps.Marker({  // 마커 생성
                position: markerPosition
            });
            marker.setMap(map);

            // 마커를 클릭했을 때 마커 위에 표시할 인포윈도우를 생성
            //위치정보 길찾기로 넘기기
            var iwContent = '<div style="padding:5px;">' + $('input[name=fcltynm]').val() +
                    '<br> <a href="https://map.kakao.com/link/to/' + $('input[name=adres]').val() +
                    ',' + la + ',' + lo + '" style="color:blue" target="_blank">길찾기</a></div>',
                iwPosition = new kakao.maps.LatLng(la, lo),
                iwRemoveable = true; // removeable 속성을 ture 로 설정하면 인포윈도우를 닫을 수 있는 x버튼이 표시됩니다

            var infowindow = new kakao.maps.InfoWindow({
                content: iwContent,
                position: iwPosition,
                removable: iwRemoveable
            });

            kakao.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });

            calculateTotalPrice();
        });


        $(document).on('change', '#count', function () {
            calculateTotalPrice();
        });


        //결제
        function calculateTotalPrice() {
            const count = $("#count").val();
            const price = $("#price").val();
            const totalPrice = count * price;

            $("#totalPrice").html(totalPrice + "원");
        }


        var IMP = window.IMP;

        function requestPay() {
            const count = $("#count").val();
            const price = $("#price").val();
            const totalPrice = count * price;
            const email = [[${member != null ? member.email : ''
        }]]
            ;
            const name = [[${member != null ? member.name : ''
        }]]
            ;
            console.log(email);
            console.log(name);

            checkLogin();

            IMP.init("imp23776017");
            IMP.request_pay(
                {
                    pg: "html5_inicis",		//KG이니시스 pg파라미터 값
                    pay_method: "card",		//결제 방법
                    merchant_uid: generateOrderNumber(),//주문번호
                    name: `[[${show.prfnm}]]`,		//상품 명
                    amount: 100,			//금액
                    buyer_email: email,
                    buyer_name: name

                },
                function (rsp) {
                    //rsp.imp_uid 값으로 결제 단건조회 API를 호출하여 결제결과를 판단합니다.
                    if (rsp.success) {
                        const token = $("meta[name='_csrf']").attr("content");
                        const header = $("meta[name='_csrf_header']").attr("content");

                        const url = "/order";

                        // 객체로 생성
                        const paramData = {
                            showNum: $("#showNum").val(),
                            count: $("#count").val()
                        };
                        // 객체를 JSON으로 변환
                        const param = JSON.stringify(paramData);

                        $.ajax({
                            url: url,
                            type: "POST",
                            /* 서버에게 보내는 데이터 타입 */
                            contentType: "application/json",
                            data: param,
                            beforeSend: function (xhr) {
                                /* 데이터를 전송하기 전에 헤더에 csrf 값을 설정 */
                                xhr.setRequestHeader(header, token)
                            },
                            /* 서버에게 결과값으로 받을 데이터 타입 */
                            dataType: "json",
                            cache: false,
                            success: function (result, status) {
                                alert("주문이 완료되었습니다.");
                                location.href = '/orders';
                            },
                            error: function (xhr, status, error) {
                                if (xhr.status == '401') {
                                    alert("로그인 후 주문해주세요")
                                    location.href = "/members/login";
                                } else {
                                    alert(xhr.responseText)
                                }
                            }
                        })
                    } else {
                        alert(rsp.error_msg);
                    }
                }
            );
        }

        function generateOrderNumber() {
            // 오늘 날짜를 YYYYMMDD 형식으로 가져오기
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // 1월은 0이므로 +1
            const day = String(today.getDate()).padStart(2, '0');
            const dateString = `${year}${month}${day}`; // YYYYMMDD 형식

            // 000부터 999까지의 랜덤 숫자 생성
            const randomNumber = String(Math.floor(Math.random() * 1000)).padStart(3, '0'); // 3자리로 맞추기

            // 주문번호 생성
            const orderNumber = `${dateString}${randomNumber}`;
            return orderNumber;
        }

        // 별점 가져오기 함수
        function getStarRating() {
            const ratingElements = document.getElementsByClassName('form-star');
            let selectedRating = 0;
            for (let i = 0; i < ratingElements.length; i++) {
                if (ratingElements[i].checked) {
                    selectedRating = ratingElements[i].value; // 선택된 별점의 value 값
                    break;
                }
            }
            return selectedRating;
        }

        //후기 추가
        function createReview() {
            const mt20id = [[${mt20id}]]; // 현재 페이지 공연 ID
            const reviewRating = getStarRating(); // 별점 가져오기
            const reviewContent = document.getElementById('review-content').value;

            const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
            const memberId = [[${memberId}]]; // 로그인 회원 ID

            // 유효성 검증
            if (reviewRating <= 0) {
                alert("별점을 선택해 주세요.");
                return;
            }
            if (!reviewContent) {
                alert("내용을 입력해 주세요");
                return;
            }

            // Ajax 요청으로 리뷰 전송
            $.ajax({
                url: `/show/${mt20id}/review`,
                type: 'POST',
                headers: {
                    [csrfHeader]: csrfToken
                },
                data: JSON.stringify({
                    rating: reviewRating,
                    content: reviewContent
                }),
                contentType: 'application/json',
                success: function (data) {
                    const reviewList = $('#review-list');
                    const starsHtml = generateStars(data.rating);

                    // 새로운 리뷰 HTML을 생성
                    const newReview = `
    <ul class="list-group-flush" id="review-${data.num}">
        <li class="list-group-item">
            <div id="rating-${data.num}">${starsHtml}</div>
            <p id="content-${data.num}">${data.content}</p>
            <span style="font-size: small">${data.obfuscatedMemberName}</span>

            <!-- 수정, 삭제 버튼 -->
            <div style="display: ${data.memberId === memberId ? 'block' : 'none'};">
                <button type="button" class="badge bi bi-pencil-square modifyReview"
                        data-bs-toggle="collapse" data-bs-target=".multi-collapse-${data.num}">수정</button>
                <button type="button" class="badge bi bi-trash deleteReview"
                        data-id="${data.num}" onclick="deleteReview(this)">삭제</button>
            </div>

            <!-- 후기 수정 폼 -->
            <div class="collapse multi-collapse-${data.num}">
                <form class="well">
                    <div class="form-group">
                        <div class="update-rating">
                            <input type="radio" name="update-${data.num}" value="5" class="form-star"
                                   id="update-rate1-${data.num}" ${data.rating === 5 ? 'checked' : ''}>
                            <label for="update-rate1-${data.num}">★</label>

                            <input type="radio" name="update-${data.num}" value="4" class="form-star"
                                   id="update-rate2-${data.num}" ${data.rating === 4 ? 'checked' : ''}>
                            <label for="update-rate2-${data.num}">★</label>

                            <input type="radio" name="update-${data.num}" value="3" class="form-star"
                                   id="update-rate3-${data.num}" ${data.rating === 3 ? 'checked' : ''}>
                            <label for="update-rate3-${data.num}">★</label>

                            <input type="radio" name="update-${data.num}" value="2" class="form-star"
                                   id="update-rate4-${data.num}" ${data.rating === 2 ? 'checked' : ''}>
                            <label for="update-rate4-${data.num}">★</label>

                            <input type="radio" name="update-${data.num}" value="1" class="form-star"
                                   id="update-rate5-${data.num}" ${data.rating === 1 ? 'checked' : ''}>
                            <label for="update-rate5-${data.num}">★</label>
                        </div>
                        <textarea name="update-content-${data.num}" id="update-content-${data.num}"
                                  class="form-control updateContent">${data.content}</textarea>
                    </div>
                    <button type="button" id="update-btn" class="btn btn-outline-primary bi bi-pencil-square"
                            data-id="${data.num}" onclick="updateReview(this)">수정</button>
                    <button type="button" class="btn btn-outline-primary bi bi-pencil-square"
                            data-id="${data.num}" onclick="resetUpdate(this)">취소</button>
                </form>
            </div>
        </li>
    </ul>`;

                    // 새롭게 추가된 리뷰를 리스트에 추가
                    reviewList.append(newReview);
                    alert("후기가 작성되었습니다.");

                    // 입력 필드 초기화
                    document.getElementById('review-content').value = '';
                    $('input[name="review"]').prop('checked', false); // 별점 초기화
                },
                error: function (xhr) {
                    console.log("error : ", xhr);
                    alert("error : " + xhr.statusText);
                }
            });
        }

        // 별점 생성 함수
        function generateStars(rating) {
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    starsHtml += '<span style="color: gold;">★</span>'; // gold 색상
                } else {
                    starsHtml += '<span style="color: lightgray;">★</span>'; // lightgray 색상
                }
            }
            return starsHtml;
        }

        // 후기 수정
        function updateReview(button) {
            const mt20id = [[${mt20id}]];
            const reviewId = button.getAttribute('data-id');

            // const mt20id = document.getElementById("update-mt20id").value; // 현재 페이지 공연 아이디
            // const reviewId = document.getElementById("update-id").value;  // 리뷰 ID 가져오기

            //기존 후기 태그 찾기
            const reviewRatingElement = document.getElementById('rating-' + reviewId);
            const reviewContentElement = document.getElementById('content-' + reviewId);
            if (!reviewRatingElement || !reviewContentElement) {
                console.error("후기를 찾을 수 없습니다");
                return;
            }

            // 수정된 내용 - 선택된 별점 가져오기
            const newRatingElement = document.querySelector('input[name="update-' + reviewId + '"]:checked');
            const newRating = newRatingElement.value;
            console.log(newRatingElement);
            if (!newRatingElement) {
                alert("별점을 수정해 주세요."); // 사용자에게 알림
                return; // 함수 종료
            }

            const newContent = document.getElementById('update-content-' + reviewId).value;
            if (!newContent) {
                alert("내용을 수정해 주세요");
                return;
            }

            console.log(newRating);
            console.log(newContent);
            console.log(reviewId);

            const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

            $.ajax({
                url: `/show/${mt20id}/review/${reviewId}`, // 수정할 리뷰의 URL
                type: 'POST', // 수정 요청
                headers: {
                    [csrfHeader]: csrfToken
                },
                data: JSON.stringify({
                    rating: newRating,
                    content: newContent
                }),
                contentType: 'application/json',
                success: function () {
                    // 별점 업데이트
                    reviewRatingElement.innerHTML = generateStars(newRating);
                    // 내용 업데이트
                    reviewContentElement.textContent = newContent;
                    alert("후기가 수정되었습니다.");
                    //수정 토글 닫기
                    $('.multi-collapse-' + reviewId).collapse('hide');
                },
                error: function (xhr) {
                    console.error("Error:", xhr);
                    alert("수정 중 오류가 발생했습니다: " + xhr.statusText);
                }
            });
        }

        //수정취소
        function resetUpdate(button) {
            const reviewId = button.getAttribute('data-id');
            $('.multi-collapse-' + reviewId).collapse('hide');
        }


        //후기 삭제
        function deleteReview(button) {
            const reviewId = button.getAttribute('data-id');
            const mt20id = [[${mt20id}]];
            const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

            if (confirm('후기를 삭제하시겠습니까?')) {
                $.ajax({
                    url: `/show/${mt20id}/review/${reviewId}`,
                    type: 'DELETE',
                    headers: {
                        [csrfHeader]: csrfToken // CSRF 토큰 추가
                    },
                    success: function () {
                        $(`#review-${reviewId}`).remove(); // jQuery를 사용하여 해당 리뷰 삭제
                        alert("삭제되었습니다");
                    },
                    error: function (xhr) {
                        console.error("Error:", xhr);
                        alert("remove error: " + xhr.statusText); // 에러 메시지 표시
                    }
                });
            }

        }

    </script>
</th:block>


<div layout:fragment="content">
    <input type="hidden" id="showNum" th:value="${show.mt20id}">
    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=35267baa78fc79afc7626fc0349548fe"></script>
    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>


    <div class="container">
        <div class="d-flex">
            <div class="wd50">

                <div class="text-right" th:if="${show.ticketStatus.name().equals('SELL')}">
                    <hr class="my-4">
                    <div class="text-right">
                        <div class="h4 text-danger text-left">
                            <input type="hidden" th:value="${show.pcseguidance}" id="price" name="price">
                            <span th:text="${show.pcseguidance}"></span> 원

                        </div>
                        <div class="input-group w-50">
                            <div class="input-group-prepend">
                        <span class="input-group-text">
                            수량
                        </span>
                            </div>
                            <input type="number" class="form-control" name="count" id="count" value="1" min="1">
                        </div>
                    </div>
                    <hr class="my-4">
                    <div class="text-right mgt-50">
                        <h5>결제금액</h5>
                        <h3 class="font-weight-bold" name="totalPrice" id="totalPrice"></h3>
                    </div>
                    <button type="button" class="btn btn-primary btn-lg" onclick="requestPay()">예매하기</button>
                </div>
                <div class="text-right"
                     th:if="${show.ticketStatus.name().equals('SOLD_OUT')}">
                    <button type="button" class="btn btn-danger btn-lg">매진</button>
                </div>
            </div>
        </div>

        <input type="hidden" id="showDetail" th:value="${show.mt20id}">
        <h1 th:text="${show.prfnm}"></h1>

        <!--공연상태-->
        <div th:switch="${show.prfstate.name()}">
            <span th:case="'EXPECT'" class="badge bg-primary">공연예정</span>
            <span th:case="'ING'" class="badge bg-success">공연중</span>
            <span th:case="'COMPLETE'" class="badge bg-secondary">공연완료</span>
        </div>

        <div class="d-flex">
            <div class="poster">
                <img th:src="${show.poster}" class="img-fluid rounded-start" th:alt="${show.prfnm}">
            </div>

            <!--즐겨찾기 : submit 하면 마이페지이로 보냄-->
            <form th:action="@{/favorite}" th:method="post" onsubmit="return checkLogin();">
                <input type="hidden" name="mt20id" th:value="${show.mt20id}">
                <input type="hidden" name="isLogin" th:value="${isLogin}">
                <button type="submit" class="btn" th:classappend="${favoriteShow}">즐겨찾기</button>
                <h4 th:text="${show.likeCount}"></h4>
            </form>

            <div class="table">
                <table class="table">
                    <tbody>
                    <tr>
                        <th scope="row">공연장소</th>
                        <td th:text="${show.fcltynm}"></td>
                    </tr>
                    <tr>
                        <th scope="row">공연기간</th>
                        <td th:text="${show.prfpdfrom} + '~' + ${show.prfpdto}"></td>
                    </tr>
                    <tr>
                        <th scope="row">관람시간</th>
                        <td th:text="${show.prfruntime}"></td>
                    </tr>
                    <tr>
                        <th scope="row">관람연령</th>
                        <td th:text="${show.prfage}"></td>
                    </tr>
                    <tr>
                        <th scope="row">가격</th>
                        <td th:text="|${show.pcseguidance}원|"></td>
                    </tr>
                    <tr>
                        <th scope="row">잔여티켓수량</th>
                        <td th:if="${show.getTicket() == 0}" th:text="매진"></td>
                        <td th:unless="${show.getTicket() == 0}" th:text="${show.getTicket()} + '매'"></td>
                    </tr>
                    <tr>
                        <th scope="row">출연진</th>
                        <td th:text="${show.prfcast}"></td>
                    </tr>
                    <tr>
                        <th scope="row">제작진</th>
                        <td th:text="${show.prfcrew}"></td>
                    </tr>
                    <tr>
                        <th scope="row">기획사</th>
                        <td th:text="${show.entrpsnm}"></td>
                    </tr>
                    <tr>
                        <th scope="row">주최</th>
                        <td th:text="${show.entrpsnmH}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <img th:src="${show.styurl}" class="img-fluid rounded-start" th:alt="${show.prfnm}">
        </div>

        <!--장소 지도 띄우기-->
        <input type="hidden" name="la" th:value="${showFacility.la}">
        <input type="hidden" name="lo" th:value="${showFacility.lo}">
        <input type="hidden" name="fcltynm" th:value="${show.fcltynm}">
        <input type="hidden" name="adres" th:value="${showFacility.adres}">
        <h3 th:text="${showFacility.adres}"></h3>
        <div id="map" style="width: 500px; height: 400px;"></div>


        <!--공연후기 작성 폼 createReview()으로 실행-->
        <div class="card">
            <div class="card-header bi bi-chat-right-dots"> Write a Review</div>
            <form id="review-form">
                <!--로그인이 되어잇을 경우-->
                <div th:if="${isLogin} == true">
                    <div class="card-body">
                        <div class="review-rating">
                            <span class="text-bold">별점을 선택해주세요</span>
                            <input type="radio" name="review" value="5" class="form-star" id="rate1">
                            <label for="rate1">★</label>
                            <input type="radio" name="review" value="4" class="form-star" id="rate2">
                            <label for="rate2">★</label>
                            <input type="radio" name="review" value="3" class="form-star" id="rate3">
                            <label for="rate3">★</label>
                            <input type="radio" name="review" value="2" class="form-star" id="rate4">
                            <label for="rate4">★</label>
                            <input type="radio" name="review" value="1" class="form-star" id="rate5">
                            <label for="rate5">★</label>
                        </div>
                        <textarea name="review" id="review-content" class="form-control"
                                  placeholder="후기를 입력하세요"></textarea>
                    </div>
                    <button type="submit" id="review-save-btn" class="btn btn-outline-primary bi bi-pencil-square">등록
                    </button>
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                </div>
                <!--로그인이 안되어 잇는 경우-->
                <div th:unless="${isLogin} == true">
                    <div class="card-body" style="font-size: small">
                        로그인 후 이용가능 합니다
                    </div>
                </div>
            </form>
        </div>

        <!--공연후기 리스트-->
        <div class="card" id="review-list">
            <div class="card-header bi bi-chat-dots"> [[${reviewCount}]] Reviews</div>
            <th:block th:each="review : ${reviews}">
                <!--댓글 번호별 아이디 부여 createReview() 메서드로 리스트 innerHtml-->
                <ul class="list-group-flush" th:id="'review-' + ${review.getNum()}">
                    <li class="list-group-item">
                        <div th:id="'rating-' + ${review.getNum()}">
                            <span th:each="i : ${T(java.util.stream.IntStream).rangeClosed(1, 5).toArray()}"
                                  th:if="${i <= review.getRating()}" style="color: gold;">★</span>
                            <span th:each="i : ${T(java.util.stream.IntStream).rangeClosed(1, 5).toArray()}"
                                  th:if="${i > review.getRating()}" style="color: lightgray;">★</span>
                        </div>
                        <p th:text="${review.getContent()}" th:id="'content-' + ${review.getNum()}">내용</p>

                        <span>
                            <span style="font-size: small" th:text="${review.getObfuscatedMemberName()}">작성자아이디</span>
                            <span style="font-size: small" th:text="${review.getCreateDate()}">작성일</span>&nbsp;
                        </span>

                        <!--작성자와 로그인회원이 같으면 수정, 삭제 가능-->
                        <div th:if="${review.getMemberId() == memberId}">
                            <button type="button" class="badge bi bi-pencil-square"
                                    data-bs-toggle="collapse"
                                    th:attr="data-bs-target='.multi-collapse-' + ${review.getNum()}">수정
                            </button>
                            <button type="button" class="badge bi bi-trash"
                                    th:attr="data-id=${review.getNum()}" onclick="deleteReview(this)">삭제
                            </button>
                        </div>

                        <!--후기 수정 폼-->
                        <div th:class="'collapse multi-collapse-' + ${review.getNum()}">
                            <form class="well">
                                <div class="form-group">
                                    <div class="update-rating">
                                        <input type="radio" th:name="'update-' + ${review.getNum()}" value="5"
                                               class="form-star"
                                               th:id="'update-rate1-' + ${review.getNum()}"
                                               th:checked="${review.getRating() == 5}">
                                        <label th:for="'update-rate1-' + ${review.getNum()}">★</label>

                                        <input type="radio" th:name="'update-' + ${review.getNum()}" value="4"
                                               class="form-star"
                                               th:id="'update-rate2-' + ${review.getNum()}"
                                               th:checked="${review.getRating() == 4}">
                                        <label th:for="'update-rate2-' + ${review.getNum()}">★</label>

                                        <input type="radio" th:name="'update-' + ${review.getNum()}" value="3"
                                               class="form-star"
                                               th:id="'update-rate3-' + ${review.getNum()}"
                                               th:checked="${review.getRating() == 3}">
                                        <label th:for="'update-rate3-' + ${review.getNum()}">★</label>

                                        <input type="radio" th:name="'update-' + ${review.getNum()}" value="2"
                                               class="form-star"
                                               th:id="'update-rate4-' + ${review.getNum()}"
                                               th:checked="${review.getRating() == 2}">
                                        <label th:for="'update-rate4-' + ${review.getNum()}">★</label>

                                        <input type="radio" th:name="'update-' + ${review.getNum()}" value="1"
                                               class="form-star"
                                               th:id="'update-rate5-' + ${review.getNum()}"
                                               th:checked="${review.getRating() == 1}">
                                        <label th:for="'update-rate5-' + ${review.getNum()}">★</label>
                                    </div>
                                    <textarea th:name="'update-content-' + ${review.getNum()}"
                                              th:id="'update-content-' + ${review.getNum()}"
                                              class="form-control updateContent">[[${review.getContent()}]]</textarea>

                                </div>
                                <button type="button" id="update-btn"
                                        class="btn btn-outline-primary bi bi-pencil-square"
                                        th:attr="data-id=${review.getNum()}" onclick="updateReview(this)">수정
                                </button>
                                <button type="button" class="btn btn-outline-primary bi bi-pencil-square"
                                        th:attr="data-id=${review.getNum()}" onclick="resetUpdate(this)">취소
                                </button>
                            </form>
                        </div>

                    </li>
                </ul>
            </th:block>

        </div>
    </div>

</div>
</html>